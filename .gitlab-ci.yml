image: zephyrprojectrtos/zephyr-build:v0.24.7

build:
  stage: build
  script:
    - rm -rf ../.west
    - source ./zephyr-env.sh
    - west init -l .
    - west update
    - west zephyr-export
    - pip3 install -r scripts/requirements-base.txt
    - pip3 install -r ../bootloader/mcuboot/scripts/requirements.txt
    - ./ci-build-and-copy.sh play blinky beagleplay_cc1352 samples/basic/blinky
    - ./ci-build-and-copy.sh play wpanusb beagleplay_cc1352 ../modules/wpanusb
    - ./ci-build-and-copy.sh play micropython beagleplay_cc1352 ../modules/micropython/ports/zephyr
    - ./ci-build-and-copy.sh play greybus-host beagleplay_cc1352 ../modules/greybus-host
    - cp boards/arm/beagle_play_cc1352/cc1352-flasher.py build/play/
    - ./ci-build-and-copy.sh freedom blinky beagleconnect_freedom samples/basic/blinky
    - ./ci-build-and-copy.sh freedom blinky_arduino beagleconnect_freedom ../modules/lib/Arduino-Zephyr-API/samples/blinky_arduino
    - ./ci-build-and-copy.sh freedom hello_arduino beagleconnect_freedom ../modules/lib/Arduino-Zephyr-API/samples/hello_arduino
    - ./ci-build-and-copy.sh freedom mcuboot beagleconnect_freedom ../bootloader/mcuboot/boot/zephyr
    - ./ci-build-and-copy.sh freedom greybus beagleconnect_freedom ../modules/greybus/samples/subsys/greybus/net mcuboot
    - ./ci-build-and-copy.sh freedom mcumgr beagleconnect_freedom samples/subsys/mgmt/mcumgr/smp_svr mcuboot
    - ./ci-build-and-copy.sh freedom sensortest beagleconnect_freedom samples/boards/beagleconnect_freedom/sensortest mcuboot
    - ./ci-build-and-copy.sh freedom wpanusb beagleconnect_freedom ../modules/wpanusb mcuboot
    - ./ci-build-and-copy.sh freedom micropython beagleconnect_freedom ../modules/micropython/ports/zephyr mcuboot
    - ./ci-build-and-copy.sh freedom-c5 blinky beagleconnect_freedom@c5 samples/basic/blinky
    - ./ci-build-and-copy.sh freedom-c5 mcuboot beagleconnect_freedom@c5 ../bootloader/mcuboot/boot/zephyr
    - ./ci-build-and-copy.sh freedom-c5 mcumgr beagleconnect_freedom@c5 samples/subsys/mgmt/mcumgr/smp_svr mcuboot
    - ./ci-build-and-copy.sh freedom-c5 sensortest beagleconnect_freedom@c5 samples/boards/beagleconnect_freedom/sensortest mcuboot
    - ./ci-build-and-copy.sh freedom-c5 wpanusb beagleconnect_freedom@c5 ../modules/wpanusb mcuboot
    - ./ci-build-and-copy.sh freedom-c5 bcfserial beagleconnect_freedom@c5 "../modules/wpanusb -- -DOVERLAY_CONFIG=overlay-bcfserial.conf -DDTC_OVERLAY_FILE=bcfserial.overlay" mcuboot
    - cp boards/arm/beagle_bcf/cc1352-flasher.py build/freedom/
  artifacts:
    paths:
      - build
